<!DOCTYPE html>
<html>
<head>
<title>REMOTE DATA VIEWER TEST</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue_grey-indigo.min.css">
<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

<style>
.chart-card.mdl-card {
  width: 788px;
}
.chart-card.mdl-card__media {
  color: #ffffff;
}

</style>

<script>
var hosts = [];
var imgWidth = 768;
var imgHeight = 512;
var imgPadding = 10;

function initialize(){
	updateImages();
}


//newIp should include port
function updateHost(whichHost, newIp){
	hosts[whichHost] = newIp;
}

function setCellSize(size){
	elements = document.getElementsByClassName("mdl-cell");
	//.className = ("mdl-cell mdl-cell--"+size+"-col");
	for(i=0; i<elements.length; i++){
		elements.item(i).className = ("mdl-cell mdl-cell--"+size+"-col");
	}
}
//high level function to add everything necessary for a new graph and set it up
function addGraph(ip){
	//make a new cell containing a new card @ index hosts.length with 'ip' as the src
	//to insert @ end:    document.getElementById('card_grid').appendChild(newCell(newCard(hosts.length, ip)));
	document.getElementById('card_grid').insertBefore(newCell(newCard(hosts.length, ip)), document.getElementById('newGraph_Button_Cell'));
	hosts.push(ip);
}

function newCell(content){
	var cell = document.createElement('div');
	cell.className = 'mdl-cell mdl-cell--6-col';
	cell.setAttribute('align','center');
	cell.appendChild(content);
	return cell;
}

function newCard(index, ip){
	// create new card and put it in the grid
	var card = document.createElement('div');
	card.id = 'card'+index;
	card.className = 'chart-card mdl-card mdl-shadow--16dp mdl-color--blue-grey-100';
	card.setAttribute('align','center');

	// create mdl-card__media and put in card
	var card__media = document.createElement('div');
	card__media.className = 'mdl-card__media';
	card.appendChild(card__media);
	
	//add img to the card__media
	var img = document.createElement('img');
	img.id = 'img'+index;
	img.setAttribute('width',imgWidth);
	img.setAttribute('height',imgHeight);
	img.setAttribute('style', "padding:"+imgPadding+"px;");
	//img.setAttirbute('border', 0);
	img.setAttribute('onerror', this.src="nanowires.png");
	img.setAttribute('alt', "(0__0) can't connect to an image server "+index+"...");
	if(index < hosts.length){
		img.src = "http://"+ip+"/DataServer/GetFrontPanelControlImage";
	}else{
		img.src = "nanowires.png";
	}
	card__media.appendChild(img);
	
	//add supporting text description to the card
	var desc = document.createElement('div');
	desc.className = 'mdl-card__supporting-text';
	desc.setAttribute('align','left');
	desc.innerHTML = "This is a plot of random numbers, generated and plotted in a pointless VI.";
	card.appendChild(desc);
	
	//add text field stuff for changing ip
	var ipFieldDiv = document.createElement('div');
	var ipForm = document.createElement('form');
	ipForm.setAttribute('action', '#');
	ipForm.setAttribute("onsubmit", "updateHost("+index+", document.getElementById('host'+"+index+").value)");
	var ipField = document.createElement('div');
	ipField.className='mdl-textfield mdl-js-textfield';
	var input = document.createElement('input');
	input.className='mdl-textfield__input';
	input.setAttribute('type','text');
	input.setAttribute('value',ip);
	input.setAttribute('id','host'+index);
	//var label = document.createElement('label');
	//label.className='mdl-textfield__label';
	//label.setAttribute('for','host'+index);
	//label.innerHTML = "Data Host IP";
	ipField.appendChild(input);
	//ipField.appendChild(label);
	ipForm.appendChild(ipField);
	ipFieldDiv.appendChild(ipForm);
	card.appendChild(ipFieldDiv);
	//alert(document.getElementById("host"+index).value);
	//ipForm.setAttribute('onsubmit', 'updateHost('+index+', '+document.getElementById("host"+index).value+')');
	
	return card;
}

function updateImage(whichImage){
	document.getElementById("img"+whichImage).src = ("http://"+hosts[whichImage]+"/DataServer/GetFrontPanelControlImage?time=" + new Date().getTime());
}

function updateImages(){
	for(i=0; i<hosts.length; i++){
		updateImage(i);
	}
}
timeout = setInterval(updateImages, 1000);


</script>
</head>

<body onload="initialize()" background="wood.jpg">



	<!-- Always shows a header, even in smaller screens. -->
	<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
		<header class="mdl-layout__header">
			<div class="mdl-layout__header-row">
				<!-- Title -->
				<span class="mdl-layout-title">LevyLab Data Viewer</span>
				<!-- Add spacer, to align navigation to the right -->
				<div class="mdl-layout-spacer"></div>
				<!-- Navigation. We hide it in small screens. -->
				<nav class="mdl-navigation mdl-layout--large-screen-only">
					<a class="mdl-navigation__link" href="https://www.levylab.org/">LevyLab Homepage</a>
					<a class="mdl-navigation__link" href="https://www.pqi.org/">Pittsburgh Quantum Institute</a>
					<a class="mdl-navigation__link" href="http://pitt.edu/">University of Pittsburgh</a>
				</nav>
			</div>
		</header>
		<div class="mdl-layout__drawer">
			<span class="mdl-layout-title">Options</span>
			<nav class="mdl-navigation">
				<a class="mdl-navigation__link" href="https://www.levylab.org/">LevyLab Homepage</a>
				<a class="mdl-navigation__link" href="https://www.pqi.org/">Pittsburgh Quantum Institute</a>
				<a class="mdl-navigation__link" href="http://pitt.edu/">University of Pittsburgh</a>
				<br>
				<button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" onClick="setCellSize(6)">
				Reset Cell Size
				</button>
				<br>
				<div>
			<!-- Slider with Starting Value -->
				<input class="mdl-slider mdl-js-slider" type="range"
				  min="1" max="12" value="6" tabindex="0" onInput="setCellSize(value)">
			</div>
				<br>
				
				<button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" onClick="addGraph('localhost:8003')">
					Create New Cell
				</button>
			</nav>
			
		</div>
		
		<main class="mdl-layout__content">
			<div class="page-content">
			<!-- Your content goes here -->
				<!-- GRID -->
				<div class="mdl-grid" id="card_grid">
					<div align="center" class="mdl-cell mdl-cell--6-col" id="newGraph_Button_Cell">
						<!-- Colored FAB button with ripple -->
						<button class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored" onClick="addGraph(document.getElementById('newGraphInput').value)">
							<i class="material-icons">add</i>
						</button>

						<div>
							<!-- Textfield with Floating Label -->
							<form action="#" onsubmit="addGraph(document.getElementById('newGraphInput').value)">
							  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
								<input class="mdl-textfield__input" type="text" id="newGraphInput">
								<label class="mdl-textfield__label" for="newGraphInput">Data Host IP ...</label>
							  </div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</main>
	</div>
	

</body>
</html>